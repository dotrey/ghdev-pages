/**
 * Copyright Â© Geoffrey-Alexeij Heinze
 * gheist cellular v0.3.0
 */
!function(){"use strict";class t{constructor(t,e){this.width=t,this.height=e,this.cells=[],this._ticks=0,this.neighborhood=null,this.rule=null;for(let t=0;t<this.width;t++)this.cells[t]=[],this.cells[t].fill(0,0,this.height);this.neighborhood=i,this.rule=s}tick(){if("function"!=typeof this.neighborhood||"function"!=typeof this.rule)return 0;let t=0,i=[];for(let s=0;s<this.width;s++){i[s]=[];for(let e=0;e<this.height;e++)i[s][e]=this.rule(this.cell(s,e),this.neighborhood(this.cells,s,e,this.width,this.height)),i[s][e]&&t++}return this.cells=i,this._ticks++,t}get ticks(){return this.ticks}get size(){return{w:this.width,h:this.height}}set(t,i,s){t<0||t>=this.width||i<0||i>=this.height||(void 0===this.cells[t]&&(this.cells[t]=[]),this.cells[t][i]=s)}cell(t,i){return t<0||t>=this.width||i<0||i>=this.height?0:(void 0===this.cells[t]&&(this.cells[t]=[]),this.cells[t][i]||0)}}function i(t,i,s,e,h){let l=(i-1+e)%e,a=(i+1)%e,n=(s-1+h)%h,o=(s+1)%h;return[t[l]&&t[l][n]||0,t[i]&&t[i][n]||0,t[a]&&t[a][n]||0,t[a]&&t[a][s]||0,t[a]&&t[a][o]||0,t[i]&&t[i][o]||0,t[l]&&t[l][o]||0,t[l]&&t[l][s]||0]}function s(t,i){if(99===t)return 99;let s=i.reduce(((t,i)=>(i>0&&t++,t)),0),e=i.reduce(((t,i)=>t+Math.min(i,11)),0);if(t>0){if(2===s||3===s)return t>10||e/s>7?0:t+1}else if(3===s)return 1;return 0}class e{constructor(){this.listeners={}}listen(t,i){void 0===this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(i)}trigger(t,i){"object"!=typeof(i=i||{})&&(i={value:i});for(let s of this.listeners[t]||[])try{s(Object.assign({},i))}catch(i){console.log("Error while handling event "+String(t)),console.log(i)}}}class h{constructor(t){this.probe=null,this.canvas=null,this.context=null,this.gradient=null,this.gradientStops=[],this.cellWidth=32,this.cellHeight=32,this.offsetX=0,this.offsetY=0,this.cells={},this.lastTs=0,this.fadeSpeed=500,this.updating=!0,this.staticOpacity=1,this.defaultOpacity=.75,this.eventhub=new e,this.gradientStops=t.gradient,this.fadeSpeed=t.fadeInterval,this.defaultOpacity=t.defaultOpacity,this.staticOpacity=t.staticOpacity,this.createCanvas()}on(t,i){this.eventhub.listen(t,i)}get dimensions(){var t,i;return{canvasWidth:(null===(t=this.canvas)||void 0===t?void 0:t.width)||0,canvasHeight:(null===(i=this.canvas)||void 0===i?void 0:i.height)||0,cellWidth:this.cellWidth,cellHeight:this.cellHeight,offsetX:this.offsetX,offsetY:this.offsetY}}setCells(t,i,s){for(let e=0;e<i;e++)for(let i=0;i<s;i++){let s=e+"-"+i;t[e]&&(t[e][i]?(this.cells[s]||(this.cells[s]=new l,this.cells[s].x=e,this.cells[s].y=i),this.cells[s].to=1,this.cells[s].from=0,this.cells[s].value=t[e][i]):this.cells[s]&&!t[e][i]&&(this.cells[s].to=0,this.cells[s].from=1,this.cells[s].value=0))}}update(t){if(!this.updating)return void(this.lastTs=0);let i=0;this.lastTs&&(i=t-this.lastTs),this.lastTs=t;let s=i/this.fadeSpeed;for(let t in this.cells)this.cells[t].from<this.cells[t].to&&this.cells[t].current<this.cells[t].to?this.cells[t].current=Math.min(this.cells[t].to,this.cells[t].current+s):this.cells[t].from>this.cells[t].to&&this.cells[t].current>this.cells[t].to&&(this.cells[t].current=Math.max(this.cells[t].to,this.cells[t].current-s)),this.cells[t].current===this.cells[t].to&&0===this.cells[t].to&&delete this.cells[t];this.draw(),window.requestAnimationFrame(this.update.bind(this))}draw(){if(this.canvas&&this.context){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.gradient||"#000000";for(let t in this.cells){let i=this.defaultOpacity;99===this.cells[t].value&&(i=this.staticOpacity),this.context.globalAlpha=this.cells[t].current*i,this.context.fillRect(this.cells[t].x*this.cellWidth+this.offsetX,this.cells[t].y*this.cellHeight+this.offsetY,this.cellWidth,this.cellHeight)}}}drawDebugPattern(){if(!this.canvas||!this.context)return;this.context.fillStyle="#ffffff",this.context.fillRect(0,0,this.canvas.width,this.canvas.height);let t=Math.ceil(this.canvas.width/this.cellWidth)+1,i=Math.ceil(this.canvas.height/this.cellHeight)+1;for(let s=0;s<t;s++)for(let t=0;t<i;t++)this.context.fillStyle=(s+t)%2==0?"#000000":"#ffffff",this.context.fillRect(s*this.cellWidth+this.offsetX,t*this.cellHeight+this.offsetY,this.cellWidth,this.cellHeight);let s=this.canvas.width/2,e=this.canvas.height/2;this.context.fillStyle="#ff0000",this.context.fillRect(s-1,e-1,2,2)}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.classList.add("cells-ts-canvas"),document.body.insertBefore(this.canvas,document.body.firstChild),this.probe=document.createElement("div"),this.probe.classList.add("cells-ts-probe"),document.body.append(this.probe),window.addEventListener("resize",(()=>{window.requestAnimationFrame(this.adjustSize.bind(this))})),window.requestAnimationFrame(this.adjustSize.bind(this))}adjustSize(){var t,i;this.canvas&&(this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.context=this.canvas.getContext("2d"),this.updateGradient(),this.cellWidth=(null===(t=this.probe)||void 0===t?void 0:t.offsetWidth)||32,this.cellHeight=(null===(i=this.probe)||void 0===i?void 0:i.offsetHeight)||32,this.offsetX=this.canvas.width/2%this.cellWidth-this.cellWidth,this.canvas.width%2==1&&(this.offsetX+=.5),this.offsetY=this.canvas.height/2%this.cellHeight-this.cellHeight,this.canvas.height%2==1&&(this.offsetY+=.5),this.eventhub.trigger("resized"),this.lastTs||window.requestAnimationFrame(this.update.bind(this)))}updateGradient(){if(this.canvas&&this.context){this.gradient=this.context.createLinearGradient(0,0,this.canvas.width,this.canvas.height);for(let t of this.gradientStops)this.gradient.addColorStop(t.stop,t.color)}}}class l{constructor(){this.value=0,this.x=0,this.y=0,this.from=0,this.to=0,this.current=0}}class a{constructor(t){this.automaton=null,this.interval=0,this.tickInterval=500,this.minAliveCells=10,this.cellSpawnChance=.1,t=Object.assign(new n,t),this.eventhub=new e,this.visuals=new h(t),this.visuals.on("resized",this.onResize.bind(this)),this.tickInterval=t.tickInterval}on(t,i){this.eventhub.listen(t,i)}tick(){if(!this.automaton)return;let t=this.automaton.tick(),i=this.automaton.size;t<this.minAliveCells&&this.randomizeAutomaton(),this.visuals.setCells(this.automaton.cells,i.w,i.h)}onResize(){let t=this.visuals.dimensions,i=Math.ceil(t.canvasWidth/t.cellWidth)+1,s=Math.ceil(t.canvasHeight/t.cellHeight)+1;this.createAutomaton(i,s),this.eventhub.trigger("resize",this.visuals.dimensions)}createAutomaton(i,s){this.interval&&(window.clearInterval(this.interval),this.interval=0),this.automaton=new t(i,s),this.automatonSetLogo(),this.interval=window.setInterval(this.tick.bind(this),this.tickInterval)}randomizeAutomaton(){if(!this.automaton)return;let t=this.automaton.size;for(let i=0;i<t.w;i++)for(let s=0;s<t.h;s++)Math.random()<this.cellSpawnChance&&this.automaton.set(i,s,1)}automatonSetLogo(){if(!this.automaton)return;let t=this.automaton.size,i=Math.floor(t.w/2),s=Math.floor(t.h/2),e=Math.floor(t.w/15),h=[[-3,-2],[-2,-2],[-1,-2],[0,-2],[3,-2],[-3,-1],[3,-1],[-3,0],[-1,0],[0,0],[1,0],[2,0],[3,0],[-3,1],[0,1],[3,1],[-3,2],[-2,2],[-1,2],[0,2],[3,2]];for(let t of h)this.automatonFillDot(i+t[0]*e,s+t[1]*e,e,99);this.visuals.setCells(this.automaton.cells,t.w,t.h)}automatonFillDot(t,i,s,e){if(!this.automaton)return;let h=t-Math.floor(s/2),l=i-Math.floor(s/2);for(let t=0;t<s;t++)for(let i=0;i<s;i++)this.automaton.set(h+t,l+i,e)}}class n{constructor(){this.gradient=[],this.tickInterval=500,this.fadeInterval=500,this.defaultOpacity=1,this.staticOpacity=1}}window.cellular=t=>new a(t)}();